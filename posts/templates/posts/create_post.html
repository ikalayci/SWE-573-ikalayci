{% extends "posts/base.html" %}
{% load static %}
{% block content %}
<div class="container mt-4">
    <h2 class="text-center mb-4 fw-bold" style="color: #34414b;">Create a Post!</h2>

    <form method="post" action="{% url 'posts:create_post' %}" enctype="multipart/form-data">
        {% csrf_token %}

        <!-- Title -->
        <div class="mb-3" style="width: 1250px;">
            
            <input 
                type="text" 
                name="title" 
                class="form-control" 
                placeholder="Enter the title of your post" 
                required 
                style="border: 2px solid #ccc; border-radius: 10px; padding: 10px; font-size: 16px; width: 100%;">
        </div>

        <!-- Wrappers Side by Side -->
        <div class="d-flex justify-content-start">
            <!-- Image Upload Wrapper -->
            <div class="border p-3" 
                style="border: 2px solid #ccc; width: 620px; border-radius: 15px; background-color: #fff; margin-right: 10px;">
                <h2 class="text-center mb-4" style="font-size: 18px;">Upload a Picture!</h2>

                <!-- Image Preview Frame -->
                <div id="image-preview-frame" class="border mb-3" 
                    style="width: 588px; height: 450px; background-color: #f8f9fa; overflow: hidden; position: relative; border-radius: 15px; display: flex; justify-content: center; align-items: center; padding: 20px;">
                    <img id="image-preview" src="" alt="Preview" 
                        style="max-width: 100%; max-height: 100%; display: none; border-radius: 15px; object-fit: contain;">
                    <p id="no-image-text" class="text-muted" style="text-align: center; margin: 0;">No Image</p>
                </div>

                <!-- Browse and File Upload -->
                <div class="mb-3">
                    <!-- Hidden File Input -->
                    <input 
                        type="file" 
                        id="image-input" 
                        name="image" 
                        class="form-control d-none" 
                        accept="image/*" 
                        onchange="handleFileSelect(event)">

                    <!-- Custom Button and File Name Container -->
                    <div class="d-flex align-items-center">
                        <!-- Browse Button -->
                        <button 
                            type="button" 
                            class="btn btn-secondary me-3" 
                            onclick="document.getElementById('image-input').click();">
                            Browse
                        </button>

                        <!-- File Name Container -->
                        <input 
                            type="text" 
                            id="file-name-container" 
                            class="form-control" 
                            placeholder="No file selected" 
                            readonly 
                            style="border: 2px solid #ccc; border-radius: 10px; padding: 10px; font-size: 14px;">
                    </div>
                </div>
            </div>
            <div style="padding: 0px; margin: 0px;">
                <!-- Story Wrapper -->
                <div class="border p-3 me-4" 
                    style="border: 2px solid #ccc; width: 620px; border-radius: 15px; background-color: #fff;">
                    <h2 class="text-center mb-4" style="font-size: 18px;">Story Of the Object!</h2>

                    <!-- Content -->
                    <div class="mb-3">
                        <textarea 
                            name="content" 
                            class="form-control" 
                            placeholder="Write your story here..."
                            style="border: 2px solid #ccc; border-radius: 10px; width: 100%; height: 300px; padding: 10px; font-size: 16px;" 
                            required></textarea>
                    </div>
                </div>

                <!-- Tags Wrapper -->
                <div class="border p-3" 
                    style="border: 2px solid #ccc; border-radius: 15px; background-color: #fff; margin-top: 10px; width: 620px; height: 220px;">
                    <h2 class="text-center mb-3" style="font-size: 18px;">Do you want to add tags to your post?</h2>
                    
                    <!-- Input Field for Tags -->
                    <div class="d-flex align-items-center mb-3">
                        <input 
                            type="text" 
                            id="additional-info" 
                            name="additional_info" 
                            class="form-control me-3" 
                            placeholder="Enter a tag" 
                            style="border: 2px solid #ccc; border-radius: 10px; padding: 10px; font-size: 12px; width: 481px;"
                            oninput="fetchWikidataSuggestions(this.value)">
                        
                        <!-- Add Tag Button -->
                        <button 
                            type="button" 
                            class="btn btn-primary" 
                            onclick="addTag()">
                            Add Tag
                        </button>
                    </div>

                    <!-- Suggestions Container -->
                    <ul id="suggestions-list" class="list-group mt-2" 
                        style="position: absolute; z-index: 1000; width: 481px; max-height: calc(3 * 5em); overflow-y: auto;">
                    </ul>

                    <!-- Tags Container -->
                    <div id="tags-container" class="mt-3">
                        <!-- Buttons for added tags will appear here -->
                    </div>
                    
                    <!-- Hidden input to store tags -->
                    <input type="hidden" name="tags_with_links" id="hidden-tags" value="[]">
                </div>
            </div>    
        </div>

        <div style="border: 2px solid #ccc; border-radius: 15px; background-color: #fff; margin-top: 10px; padding-top: 20px; width: 1250px;">
            <h2 class="text-center mb-1" style="font-size: 18px;">Properties of the Mysterious Object!</h2>
            <div class="d-flex justify-content-start">
                
                <div class="border p-3" 
                    style="border: none !important; border-radius: 15px; background-color: #fff; margin-top: 0%; margin-left: 0px; width: 630px;">
                    

                    <div class="border p-3" 
                        style="border: 2px solid #ccc; border-radius: 15px; background-color: #fff; margin-top: 10px; height: 250px;">
                        <h3 class="text-center mb-3" style="font-size: 18px;">Colors of the Object</h3>
                        
                        <div class="d-flex align-items-center mb-3">
                            <!-- Color Picker -->
                            <div class="me-3" style="flex-grow: 1;">
                                <label for="color-picker" class="form-label">Click on the bar to pick a color!</label>
                                <input 
                                    type="color" 
                                    id="color-picker" 
                                    name="color" 
                                    value="#ffffff" 
                                    placeholder="Select a color!"
                                    class="form-control form-control-color"
                                    style="border: 2px solid #ccc; border-radius: 10px; padding: 5px; width: 100%;">
                            </div>
                            <!-- Add Color Button -->
                            <button 
                                type="button" 
                                class="btn btn-primary" 
                                style="margin-top: 30px;"
                                onclick="addColor()">
                                Add Color                        
                            </button>
                        </div>
                        <!-- Colors Container -->
                        <div id="colors-container" class="mb-1">
                        <!-- Added color buttons will appear here -->
                        </div>
                        <!-- Hidden input to store colors -->
                        <input type="hidden" name="colors" id="hidden-colors" value="">
                    </div>

                    <div class="border p-3" 
                        style="border: 2px solid #ccc; border-radius: 15px; background-color: #fff; margin-top: 10px;">
                        <h3 class="text-center mb-3" style="font-size: 18px;">Size of the Object</h3>
                        <h3 class="text-center mb-3" style="font-size: 14px;">Type only numeric values in the textboxes. Use dot (.) for decimal numbers.</h3>
                        
                        <!-- Default Image with Buttons -->
                        <div class="d-flex justify-content-between align-items-start">
                            <!-- Default Image -->
                            <div style="flex-grow: 1;">
                                <img src="{% static 'images/default_dimensions.jpg' %}" 
                                    alt="Default Size Dimensions" 
                                    class="img-fluid" 
                                    style="max-width: 100%; border: 1px solid #ccc; border-radius: 10px;">
                            </div>
                            
                            <!-- Buttons and Textboxes Container -->
                            <div class="ms-3">
                                <!-- Buttons Container -->
                                <div class="d-flex mb-3">
                                    <!-- Assign Sizes Button -->
                                    <button type="button" class="btn btn-primary me-2" onclick="assignSizes()">
                                        Assign Sizes
                                    </button>
                                    <!-- Reset Sizes Button -->
                                    <button type="button" class="btn btn-secondary" onclick="resetSizes()">
                                        Reset Sizes
                                    </button>
                                </div>
                        
                                <!-- Textboxes Container -->
                                <div>
                                    <!-- Length Textbox with Label and Button -->
                                    <div class="d-flex align-items-center mb-2">
                                        <input 
                                            type="text" 
                                            id="length-input" 
                                            name="length" 
                                            class="form-control me-2" 
                                            placeholder="Enter Length" 
                                            style="border: 2px solid #ccc; border-radius: 10px; padding: 10px; font-size: 12px; width: 100px;">
                                        <span style="white-space: nowrap; font-size: 14px; color: #333; width: 20px;"><strong>L:</strong></span>
                                        <button type="button" class="btn btn-secondary btn-sm ms-2" id="length-button" style="width: 85px;"></button>
                                    </div>
                                
                                    <!-- Width Textbox with Label and Button -->
                                    <div class="d-flex align-items-center mb-2">
                                        <input 
                                            type="text" 
                                            id="width-input" 
                                            name="width" 
                                            class="form-control me-2" 
                                            placeholder="Enter Width" 
                                            style="border: 2px solid #ccc; border-radius: 10px; padding: 10px; font-size: 12px; width: 100px;">
                                        <span style="white-space: nowrap; font-size: 14px; color: #333; width: 20px;"><strong>W:</strong></span>
                                        <button type="button" class="btn btn-secondary btn-sm ms-2" id="width-button" style="width: 85px;"></button>
                                    </div>
                                
                                    <!-- Height Textbox with Label and Button -->
                                    <div class="d-flex align-items-center">
                                        <input 
                                            type="text" 
                                            id="height-input" 
                                            name="height" 
                                            class="form-control me-2" 
                                            placeholder="Enter Height" 
                                            style="border: 2px solid #ccc; border-radius: 10px; padding: 10px; font-size: 12px; width: 100px;">
                                        <span style="white-space: nowrap; font-size: 14px; color: #333; width: 20px;"><strong>H:</strong></span>
                                        <button type="button" class="btn btn-secondary btn-sm ms-2" id="height-button" style="width: 85px;"></button>
                                    </div>
                                </div>
                                <!-- Hidden inputs to store the values -->
                                <input type="hidden" id="hidden-length" name="hidden_length" value="">                           
                                <input type="hidden" id="hidden-width" name="hidden_width" value="">
                                <input type="hidden" id="hidden-height" name="hidden_height" value="">
                            </div>
                        </div>
                    </div>

                    <div class="border p-3" 
                        style="border: 2px solid #ccc; border-radius: 15px; background-color: #fff; margin-top: 10px;">
                        <h3 class="text-center mb-3" style="font-size: 18px;">Weight of the Object!</h3>
                        <p class="text-muted">Please consider [g] as unit of measure! Use dot (.) for decimal numbers!</p>
                        <!-- Hidden input to store weight -->
                        <input type="hidden" name="hidden_weight" id="hidden-weight" value="">
                        <div class="d-flex align-items-center">
                            <!-- Example Content -->
                            <div style="padding: 10px;">
                                <input 
                                    type="text" 
                                    id="weight" 
                                    name="weight" 
                                    class="form-control"
                                    step="0.01" 
                                    placeholder="Enter some value" 
                                    style="border: 2px solid #ccc; border-radius: 10px; padding: 10px; font-size: 14px; width: 160px;"
                                    maxlength="11"/>
                            </div>
                            <div class="d-flex align-items-center">
                                <!-- Assign Weight Button -->
                                <button 
                                    type="button" 
                                    class="btn btn-primary" 
                                    style="height: 45px; width: 130px;" 
                                    onclick="assignWeight()">
                                    Assign Weight
                                </button>
                            </div>
                            <strong class="text-muted" style="margin-left: 10px;">Weight [g]:</strong>
                            <!-- Container to hold the weight button -->
                            <div id="weight-container" style="margin-left: 10px;"></div>
                        </div>                   
                    </div>

                    <div class="border p-3" 
                        style="border: 2px solid #ccc; border-radius: 15px; background-color: #fff; margin-top: 10px;">
                        <h3 class="text-center mb-3" style="font-size: 18px;">Price of the Object!</h3>
                        <p class="text-muted">Please consider [$] as currency! Use dot (.) for decimal numbers!</p>
                        <!-- Hidden input to store price-->
                        <input type="hidden" name="hidden_price" id="hidden-price" value="">
                        <div class="d-flex align-items-center">
                            <!-- Example Content -->
                            <div style="padding: 10px;">
                                <input 
                                    type="text" 
                                    id="price" 
                                    name="price" 
                                    class="form-control"
                                    step="0.01" 
                                    placeholder="Enter some value" 
                                    style="border: 2px solid #ccc; border-radius: 10px; padding: 10px; font-size: 14px; width: 160px;"
                                    maxlength="11"/>
                            </div>
                            <div class="d-flex align-items-center">
                                <!-- Assign Price Button -->
                                <button 
                                    type="button" 
                                    class="btn btn-primary" 
                                    style="height: 45px; width: 130px;" 
                                    onclick="assignPrice()">
                                    Assign Price
                                </button>
                            </div>
                            <strong class="text-muted" style="margin-left: 10px;">Price [$]:</strong>
                            <!-- Container to hold the weight button -->
                            <div id="price-container" style="margin-left: 10px;"></div>
                        </div>                   
                    </div>

                    <div class="border p-3"
                        style="border: 2px solid #ccc; border-radius: 15px; background-color: #fff; margin-top: 10px;">
                        <h3 class="text-center mb-3" style="font-size: 18px;">Time Period of the Object!</h3>
                        <p class="text-muted">You can specify the time as YYYY, MMM/YYYY, or DD/MMM/YYYY. Use the dropdowns and textbox to provide details.</p> 
                        <input type="hidden" name="era" id="hidden-era" value="">
                        <input type="hidden" name="time_period" id="hidden-time-period" value="">                               
                        <div class="d-flex align-items-center">
                            <!-- Time Period Input -->
                            <div class="me-3" style="width: 160px;">
                                <!-- Era Section -->
                                <div class="me-3">
                                    <select id="era" name="era" class="form-control"
                                            style="border: 2px solid #ccc; border-radius: 10px; padding: 10px; font-size: 14px; width: 160px; margin-bottom: 2px;">
                                        <option value="">Select Era</option>
                                        <option value="AC">AC</option>
                                        <option value="BC">BC</option>
                                    </select>
                                </div>
                    
                                <!-- Time Period Textbox -->
                                <div class="me-3">
                                    <input
                                        type="text"
                                        id="year"
                                        name="year"
                                        class="form-control"
                                        placeholder="Type the Year"
                                        style="border: 2px solid #ccc; border-radius: 10px; padding: 10px; font-size: 14px; width: 160px; margin-bottom: 2px" />
                                </div>
                    
                                <!-- Month Selection -->
                                <div class="me-3">
                                    <select id="month" name="month" class="form-control"
                                            style="border: 2px solid #ccc; border-radius: 10px; padding: 10px; font-size: 14px; width: 160px; margin-bottom: 2px">
                                            <option value="00">Select Month</option>
                                            <option value="01">JAN</option>
                                            <option value="02">FEB</option>
                                            <option value="03">MAR</option>
                                            <option value="04">APR</option>
                                            <option value="05">MAY</option>
                                            <option value="06">JUN</option>
                                            <option value="07">JUL</option>
                                            <option value="08">AUG</option>
                                            <option value="09">SEP</option>
                                            <option value="10">OCT</option>
                                            <option value="11">NOV</option>
                                            <option value="12">DEC</option>
                                    </select>
                                </div>
                    
                                <!-- Day Selection -->
                                <div class="me-3">
                                    <select id="day" name="day" class="form-control"
                                            style="border: 2px solid #ccc; border-radius: 10px; padding: 10px; font-size: 14px; width: 160px; margin-bottom: 2px">
                                        <option value="00">Select Day</option>
                                        <option value="ValueA">Value A</option>
                                        <option value="ValueB">Value B</option>
                                    </select>
                                </div>
                            </div>
                            
                            <!-- Assign Time Button -->
                            <div class="me-3 d-flex align-items-start" style="height: 50px;">
                                <button
                                    type="button"
                                    class="btn btn-primary"
                                    style="height: 45px; width: 130px;"
                                    onclick="assignTimePeriod()">
                                    Assign Time
                                </button>
                            </div>
                            <!-- Assigned Time Display -->
                            <div class="me-3" style="height: 50px; display: flex; flex-direction: column;">
                                <strong class="text-muted">Assigned Time:</strong>
                                <div class="d-flex align-items-start mt-2">
                                    <!-- Era Button -->
                                    <div id="era-container"></div>
                                    
                                    <!-- Date Display Button -->
                                    <div id="time-period-display-container"></div>
                                    
                                    <!-- X Button -->
                                    <div id="remove-button-container"></div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <div class="border p-0" 
                        style="border: none !important; border-radius: 15px; background-color: #fff; margin-top: 0%; margin-right: 20px; width: 598px;">

                        <!-- Shapes of the Object Wrapper -->
                        <div class="border p-3" style="border: 2px solid #ccc; border-radius: 15px; background-color: #fff; margin-top: 10px;">
                            <h3 class="text-center mb-3" style="font-size: 18px;">Shapes of the Object</h3>
                            <input type="hidden" name="shapes" id="hidden-shapes" value="[]">
                            <div class="d-flex justify-content-start">
                                
                                <div class="border p-3 mb-2" style="border: 1px solid #ddd; border-radius: 10px; margin-right: 10px; width: 310px;">
                                    <!-- Two-Dimensional (2D) Shapes -->
                                    <h4 style="font-size: 18px;">Two-Dimensional (2D) Shapes</h4>
                                    <div>
                                        <label><input type="checkbox" name="shapes[]" value="Circle"> Circle</label><br>
                                        <label><input type="checkbox" name="shapes[]" value="Triangle"> Triangle</label><br>
                                        <label><input type="checkbox" name="shapes[]" value="Square"> Square</label><br>
                                        <label><input type="checkbox" name="shapes[]" value="Rectangle"> Rectangle</label><br>
                                        <label><input type="checkbox" name="shapes[]" value="Parallelogram"> Parallelogram</label><br>
                                        <label><input type="checkbox" name="shapes[]" value="Rhombus"> Rhombus</label><br>
                                        <label><input type="checkbox" name="shapes[]" value="Trapezoid"> Trapezoid</label><br>
                                        <label><input type="checkbox" name="shapes[]" value="Kite"> Kite</label><br>
                                        <label><input type="checkbox" name="shapes[]" value="Pentagon"> Pentagon</label><br>
                                        <label><input type="checkbox" name="shapes[]" value="Hexagon"> Hexagon</label><br>
                                        <label><input type="checkbox" name="shapes[]" value="Heptagon"> Heptagon</label><br>
                                        <label><input type="checkbox" name="shapes[]" value="Octagon"> Octagon</label><br>
                                        <label><input type="checkbox" name="shapes[]" value="Other Polygons"> Other Polygons</label><br>
                                        <label><input type="checkbox" name="shapes[]" value="Ellipse"> Ellipse</label><br>
                                        <label><input type="checkbox" name="shapes[]" value="Oval"> Oval</label><br>
                                        <label><input type="checkbox" name="shapes[]" value="Crescent"> Crescent</label><br>
                                        <label><input type="checkbox" name="shapes[]" value="Sector"> Sector of a Circle</label><br>
                                        <label><input type="checkbox" name="shapes[]" value="Annulus"> Annulus (ring shape)</label><br>
                                        <label><input type="checkbox" name="shapes[]" value="Pentagram"> 5-pointed Star (Pentagram)</label><br>
                                        <label><input type="checkbox" name="shapes[]" value="Hexagram"> 6-pointed Star (Hexagram)</label><br>
                                        <label><input type="checkbox" name="shapes[]" value="Other Star Shapes"> Other Star Shapes</label><br>
                                        <label><input type="checkbox" name="shapes[]" value="Cross"> Cross</label><br>
                                        <label><input type="checkbox" name="shapes[]" value="Arrow"> Arrow Shapes</label><br>
                                        <label><input type="checkbox" name="shapes[]" value="Freeform or Abstract"> Freeform or Abstract Shapes</label>
                                    </div>
                                </div>

                                <div class="border p-3 mb-2" style="border: 1px solid #ddd; border-radius: 10px; width: 310px;">
                                    <!-- Three-Dimensional (3D) Shapes -->
                                    <h4 style="font-size: 18px;">Three-Dimensional (3D) Shapes</h4>
                                    <div>
                                        <label><input type="checkbox" name="shapes[]" value="Sphere"> Sphere</label><br>
                                        <label><input type="checkbox" name="shapes[]" value="Cube"> Cube</label><br>
                                        <label><input type="checkbox" name="shapes[]" value="Rectangular Prism"> Rectangular Prism (Cuboid)</label><br>
                                        <label><input type="checkbox" name="shapes[]" value="Cylinder"> Cylinder</label><br>
                                        <label><input type="checkbox" name="shapes[]" value="Cone"> Cone</label><br>
                                        <label><input type="checkbox" name="shapes[]" value="Pyramid"> Pyramid</label><br>
                                        <label><input type="checkbox" name="shapes[]" value="Polyhedra"> Polyhedra</label><br>
                                        <label><input type="checkbox" name="shapes[]" value="Torus"> Torus (doughnut shape)</label><br>
                                        <label><input type="checkbox" name="shapes[]" value="Ellipsoid"> Ellipsoid</label><br>
                                        <label><input type="checkbox" name="shapes[]" value="Prism"> Prism (Triangular, Pentagonal, etc.)</label><br>
                                        <label><input type="checkbox" name="shapes[]" value="Antiprism"> Antiprism</label><br>
                                        <label><input type="checkbox" name="shapes[]" value="Frustum"> Frustum (truncated pyramid or cone)</label>
                                    </div>
                                    <div style="margin-top: 10px;">
                                    <!-- Natural and Organic Shapes -->
                                    <h4 style="font-size: 18px;">Natural and Organic Shapes</h4>
                                        <div>
                                            <label><input type="checkbox" name="shapes[]" value="Leaf"> Leaf</label><br>
                                            <label><input type="checkbox" name="shapes[]" value="Heart"> Heart</label><br>
                                            <label><input type="checkbox" name="shapes[]" value="Spiral"> Spiral</label><br>
                                            <label><input type="checkbox" name="shapes[]" value="Wave"> Wave</label><br>
                                            <label><input type="checkbox" name="shapes[]" value="Blob"> Blob or Freeform Shapes</label><br>
                                        </div>
                                    </div>
                                    <div style="margin-top: 10px;">
                                        <label><h4 style="font-size: 18px;"><input type="checkbox" name="shapes[]" value="Other Shapes"> Other Shapes</h4></label>
                                    </div>
                                </div>
                            </div>

                            <div class="d-flex align-items-center">
                                <button type="button" class="btn btn-primary mt-3" style="height: 45px; width: 200px;" onclick="assignShapes()">Assign Shapes</button>
                                <strong class="text-muted" style="margin-left: 100px;">Assigned Shapes:</strong>
                            </div>
                            <div id="shapes-container" class="d-flex flex-wrap mt-2 p-3" style="min-height: 312px;">
                                <!-- Shapes Buttons Container -->
                            </div>      
                        </div>
                    </div>
                </div>

                <div class="border p-3" 
                    style="border: none !important; border-radius: 15px; background-color: #fff; margin-top: 0%; margin-left: 0px; width: 610px;">
                    

                    <!-- Materials of the Object Wrapper -->
                    <div class="border p-3" style="border: 2px solid #ccc; border-radius: 15px; background-color: #fff; margin-top: 10px;">
                        <h3 class="text-center mb-3" style="font-size: 18px;">Materials of the Object</h3>
                        <input type="hidden" name="materials" id="hidden-materials" value="[]">
                        <div class="d-flex justify-content-start">
                            
                            <div class="border p-3 mb-2" style="border: 1px solid #ddd; border-radius: 10px; margin-right: 10px; width: 300px;">
                                <!-- Natural Materials -->
                                <h4 style="font-size: 18px;">Natural Materials</h4>
                                <div>
                                    <label><input type="checkbox" name="materials[]" value="Wood"> Wood</label><br>
                                    <label><input type="checkbox" name="materials[]" value="Bamboo"> Bamboo</label><br>
                                    <label><input type="checkbox" name="materials[]" value="Cotton"> Cotton</label><br>
                                    <label><input type="checkbox" name="materials[]" value="Leather"> Leather</label><br>
                                    <label><input type="checkbox" name="materials[]" value="Wool"> Wool</label><br>
                                    <label><input type="checkbox" name="materials[]" value="Natural rubber"> Natural rubber</label><br>
                                    <label><input type="checkbox" name="materials[]" value="Cork"> Cork</label><br>
                                    <label><input type="checkbox" name="materials[]" value="Stone"> Stone (e.g., granite, marble)</label><br>
                                    <label><input type="checkbox" name="materials[]" value="Clay"> Clay</label><br>
                                    <label><input type="checkbox" name="materials[]" value="Sand"> Sand</label><br>
                                    <label><input type="checkbox" name="materials[]" value="Minerals"> Minerals (e.g., quartz, feldspar)</label><br>
                                    <label><input type="checkbox" name="materials[]" value="Gold"> Gold</label><br>
                                    <label><input type="checkbox" name="materials[]" value="Silver"> Silver</label><br>
                                    <label><input type="checkbox" name="materials[]" value="Platinum"> Platinum</label>
                                </div>
                                <div style="margin-top: 10px;">
                                    <!-- Metals and Alloys -->
                                    <h4 style="font-size: 18px;">Metals and Alloys</h4>
                                    <div>
                                        <label><input type="checkbox" name="materials[]" value="Steel"> Steel</label><br>
                                        <label><input type="checkbox" name="materials[]" value="Cast iron"> Cast iron</label><br>
                                        <label><input type="checkbox" name="materials[]" value="Wrought iron"> Wrought iron</label>
                                        <label><input type="checkbox" name="materials[]" value="Aluminum"> Aluminum</label><br>
                                        <label><input type="checkbox" name="materials[]" value="Copper"> Copper</label><br>
                                        <label><input type="checkbox" name="materials[]" value="Brass"> Brass</label><br>
                                        <label><input type="checkbox" name="materials[]" value="Bronze"> Bronze</label><br>
                                        <label><input type="checkbox" name="materials[]" value="Titanium"> Titanium</label><br>
                                        <label><input type="checkbox" name="materials[]" value="Nickel"> Nickel</label><br>
                                        <label><input type="checkbox" name="materials[]" value="Zinc"> Zinc</label><br>
                                    </div>
                                </div>
                                <div style="margin-top: 10px;">
                                    <!-- Composites -->
                                    <h4 style="font-size: 18px;">Composites</h4>
                                    <div>
                                        <label><input type="checkbox" name="materials[]" value="Carbon fiber"> Carbon fiber-reinforced plastic (CFRP)</label><br>
                                        <label><input type="checkbox" name="materials[]" value="Fiberglass"> Fiberglass</label><br>
                                        <label><input type="checkbox" name="materials[]" value="Concrete"> Concrete</label><br>
                                        <label><input type="checkbox" name="materials[]" value="Plywood"> Plywood</label><br>
                                        <label><input type="checkbox" name="materials[]" value="Laminates"> Laminates</label><br>
                                        <label><input type="checkbox" name="materials[]" value="Kevlar composites"> Kevlar composites</label>
                                    </div>
                                </div>                                               
                            </div>

                            <div class="border p-3 mb-2" style="border: 1px solid #ddd; border-radius: 10px; width: 300px;">
                                <!-- Polymers (Plastics) -->
                                <h4 style="font-size: 18px;">Polymers (Plastics)</h4>
                                <div>
                                    <label><input type="checkbox" name="materials[]" value="Polyethylene"> Polyethylene (PE)</label><br>
                                    <label><input type="checkbox" name="materials[]" value="Polypropylene"> Polypropylene (PP)</label><br>
                                    <label><input type="checkbox" name="materials[]" value="Polyvinyl chloride"> Polyvinyl chloride (PVC)</label><br>
                                    <label><input type="checkbox" name="materials[]" value="Polystyrene"> Polystyrene (PS)</label><br>
                                    <label><input type="checkbox" name="materials[]" value="Nylon"> Nylon</label><br>
                                    <label><input type="checkbox" name="materials[]" value="Acrylic"> Acrylic</label><br>
                                    <label><input type="checkbox" name="materials[]" value="Epoxy"> Epoxy</label><br>
                                    <label><input type="checkbox" name="materials[]" value="Phenolic resin"> Phenolic resin</label><br>
                                    <label><input type="checkbox" name="materials[]" value="Polyurethane"> Polyurethane</label><br>
                                    <label><input type="checkbox" name="materials[]" value="Silicone"> Silicone</label><br>
                                    <label><input type="checkbox" name="materials[]" value="Synthetic rubber"> Synthetic rubber</label><br>
                                    <label><input type="checkbox" name="materials[]" value="Neoprene"> Neoprene</label><br>
                                    <label><input type="checkbox" name="materials[]" value="Latex"> Latex</label>
                                </div>
                                <div style="margin-top: 10px;">
                                    <!-- Ceranics -->
                                    <h4 style="font-size: 18px;">Ceramics</h4>
                                    <div>
                                        <label><input type="checkbox" name="materials[]" value="Porcelain"> Porcelain</label><br>
                                        <label><input type="checkbox" name="materials[]" value="Glass"> Glass</label><br>
                                        <label><input type="checkbox" name="materials[]" value="Brick"> Brick</label><br>
                                        <label><input type="checkbox" name="materials[]" value="Tile"> Tile</label><br>
                                        <label><input type="checkbox" name="materials[]" value="Silicon carbide"> Silicon carbide</label>
                                        <label><input type="checkbox" name="materials[]" value="Alumina"> Alumina</label>
                                    </div>
                                </div>
                                <div style="margin-top: 10px;">
                                    <!-- Foams and Textiles -->
                                    <h4 style="font-size: 18px;">Foams and Textiles</h4>
                                    <div>
                                        <label><input type="checkbox" name="materials[]" value="Styrofoam"> Styrofoam</label><br>
                                        <label><input type="checkbox" name="materials[]" value="Memory foam"> Memory foam</label><br>
                                        <label><input type="checkbox" name="materials[]" value="Polyester"> Polyester</label><br>
                                        <label><input type="checkbox" name="materials[]" value="Silk"> Silk</label><br>
                                        <label><input type="checkbox" name="materials[]" value="Canvas"> Canvas</label><br>
                                        <label><input type="checkbox" name="materials[]" value="Tulle"> Tulle</label><br>
                                        <label><input type="checkbox" name="materials[]" value="Velvet"> Velvet</label><br>
                                        <label><input type="checkbox" name="materials[]" value="Satin"> Satin</label><br>
                                        <label><input type="checkbox" name="materials[]" value="Fleece"> Fleece</label><br>
                                        <label><input type="checkbox" name="materials[]" value="Gore-Tex"> Gore-Tex</label>
                                    </div>
                                </div>
                                <div style="margin-top: 10px;">
                                    <label><h4 style="font-size: 18px;"><input type="checkbox" name="materials[]" value="Other Materials"> Other Materials</h4></label>
                                </div>       
                            </div>
                        </div>

                        <div class="d-flex align-items-center">
                            <div class="d-flex align-items-center">
                                <!-- Assign Materials Button -->
                                <button 
                                    type="button" 
                                    class="btn btn-primary mt-3" 
                                    style="height: 45px; width: 200px;"
                                    onclick="assignMaterials()">Assign Materials
                                </button>
                            </div>
                            <strong class="text-muted" style="margin-left: 100px;">Assigned Materials:</strong>
                        </div>
                            <!-- Assigned Material Buttons Section -->
                            <div class="d-flex flex-wrap mt-2 p-3" style="min-height: 150px;">
                                <!-- Material Buttons Container -->
                                <div id="materials-container" class="d-flex flex-wrap"></div>

                                <!-- Remove Button Container -->
                                <div id="remove-button-container"></div>
                            </div>
                        </div> 
                        
                        <div class="border p-0" 
                            style="border: none !important; border-radius: 15px; background-color: #fff; margin-top: 0%; margin-right: 20px; width: 578px;">

                            <!-- Textures of the Object Wrapper -->
                            <div class="border p-3" style="border: 2px solid #ccc; border-radius: 15px; background-color: #fff; margin-top: 10px;">
                                <h3 class="text-center mb-3" style="font-size: 18px;">Textures of the Object</h3>
                                <input type="hidden" name="textures" id="hidden-textures" value="[]">

                                <div class="d-flex justify-content-start">
                                    <div class="border p-3 mb-2" style="border: 1px solid #ddd; border-radius: 10px; margin-right: 10px; width: 310px;">
                                        <!-- Natural Textures -->
                                        <h4 style="font-size: 18px;">Natural Textures</h4>
                                        <div>
                                            <label><input type="checkbox" name="textures[]" value="Woodgrain"> Woodgrain</label><br>
                                            <label><input type="checkbox" name="textures[]" value="Bark"> Bark (Tree)</label><br>
                                            <label><input type="checkbox" name="textures[]" value="Stoney"> Stoney</label><br>
                                            <label><input type="checkbox" name="textures[]" value="Pebbles"> Pebbles</label><br>
                                            <label><input type="checkbox" name="textures[]" value="Sand"> Sand</label><br>
                                            <label><input type="checkbox" name="textures[]" value="Grass"> Grass</label><br>
                                            <label><input type="checkbox" name="textures[]" value="Leaves"> Leaves</label><br>
                                            <label><input type="checkbox" name="textures[]" value="Fur"> Fur</label><br>
                                            <label><input type="checkbox" name="textures[]" value="Feathers"> Feathers</label><br>
                                            <label><input type="checkbox" name="textures[]" value="Animal Skin"> Animal Skin (e.g., scales, hide)</label><br>
                                            <label><input type="checkbox" name="textures[]" value="Water"> Water (Ripples, Waves)</label><br>
                                            <label><input type="checkbox" name="textures[]" value="Ice"> Ice</label><br>
                                            <label><input type="checkbox" name="textures[]" value="Clouds"> Clouds</label><br>
                                            <label><input type="checkbox" name="textures[]" value="Soil"> Soil or Dirt</label><br>
                                            <label><input type="checkbox" name="textures[]" value="Moss"> Moss</label>
                                        </div>
                                        <!-- Organic and Abstract Textures -->
                                        <h4 style="font-size: 18px; margin-top: 10px;">Organic and Abstract Textures</h4>
                                        <div>
                                            <label><input type="checkbox" name="textures[]" value="Bubbles"> Bubbles</label><br>
                                            <label><input type="checkbox" name="textures[]" value="Waves"> Waves or Ripples</label><br>
                                            <label><input type="checkbox" name="textures[]" value="Cracks"> Cracks or Crazing</label><br>
                                            <label><input type="checkbox" name="textures[]" value="Swirls"> Swirls</label><br>
                                            <label><input type="checkbox" name="textures[]" value="Grunge"> Grunge or Distressed</label><br>
                                            <label><input type="checkbox" name="textures[]" value="Gradient"> Gradient or Fade</label><br>
                                            <label><input type="checkbox" name="textures[]" value="Geometric Patterns"> Geometric Patterns</label><br>
                                            <label><input type="checkbox" name="textures[]" value="Organic Patterns"> Organic Patterns (e.g., marbling)</label>
                                        </div>
                                        <!-- Surface Finish Textures -->
                                        <h4 style="font-size: 18px; margin-top: 10px;">Surface Finish Textures</h4>
                                        <div>
                                            <label><input type="checkbox" name="textures[]" value="Polished"> Polished</label><br>
                                            <label><input type="checkbox" name="textures[]" value="Brushed"> Brushed</label><br>
                                            <label><input type="checkbox" name="textures[]" value="Satin Texture"> Satin Texture</label><br>
                                            <label><input type="checkbox" name="textures[]" value="Matte"> Matte</label><br>
                                            <label><input type="checkbox" name="textures[]" value="Frosted"> Frosted</label><br>
                                            <label><input type="checkbox" name="textures[]" value="Transparent"> Transparent</label><br>
                                            <label><input type="checkbox" name="textures[]" value="Opaque"> Opaque</label>
                                        </div>
                                    </div>

                                    
                                    <div class="border p-3 mb-2" style="border: 1px solid #ddd; border-radius: 10px; width: 310px;">
                                        <!-- Man-Made Textures -->
                                        <h4 style="font-size: 18px;">Man-Made Textures</h4>
                                        <div>
                                            <label><input type="checkbox" name="textures[]" value="Fabric"> Fabric (e.g., cotton, linen, silk, velvet)</label><br>
                                            <label><input type="checkbox" name="textures[]" value="Carpet"> Carpet or Rug</label><br>
                                            <label><input type="checkbox" name="textures[]" value="Brick"> Brick</label><br>
                                            <label><input type="checkbox" name="textures[]" value="Metal"> Metal (e.g., polished, brushed, rusted)</label><br>
                                            <label><input type="checkbox" name="textures[]" value="Glass"> Glass (e.g., smooth, frosted, cracked)</label><br>
                                            <label><input type="checkbox" name="textures[]" value="Paper"> Paper (e.g., smooth, rough, crumpled)</label><br>
                                            <label><input type="checkbox" name="textures[]" value="Plastic"> Plastic (e.g., smooth, textured)</label><br>
                                            <label><input type="checkbox" name="textures[]" value="Ceramic"> Ceramic (e.g., glazed, unglazed)</label><br>
                                            <label><input type="checkbox" name="textures[]" value="Painted Surface"> Painted Surface</label><br>
                                            <label><input type="checkbox" name="textures[]" value="Tiles"> Tiles (e.g., smooth, mosaic)</label><br>
                                            <label><input type="checkbox" name="textures[]" value="Rubberish"> Rubberish</label>
                                        </div>
                                        <!-- Tactile and Surface Finish Textures -->
                                        <h4 style="font-size: 18px; margin-top: 10px;">Tactile and Surface Finish Textures</h4>
                                        <div>
                                            <label><input type="checkbox" name="textures[]" value="Smooth"> Smooth</label><br>
                                            <label><input type="checkbox" name="textures[]" value="Rough"> Rough</label><br>
                                            <label><input type="checkbox" name="textures[]" value="Soft"> Soft</label><br>
                                            <label><input type="checkbox" name="textures[]" value="Hard"> Hard</label><br>
                                            <label><input type="checkbox" name="textures[]" value="Glossy"> Glossy</label><br>
                                            <label><input type="checkbox" name="textures[]" value="Matte"> Matte</label><br>
                                            <label><input type="checkbox" name="textures[]" value="Slippery"> Slippery</label><br>
                                            <label><input type="checkbox" name="textures[]" value="Sticky"> Sticky</label><br>
                                            <label><input type="checkbox" name="textures[]" value="Fuzzy"> Fuzzy</label><br>
                                            <label><input type="checkbox" name="textures[]" value="Grainy"> Grainy</label><br>
                                            <label><input type="checkbox" name="textures[]" value="Bumpy"> Bumpy</label><br>
                                            <label><input type="checkbox" name="textures[]" value="Corrugated"> Corrugated</label><br>
                                            <label><input type="checkbox" name="textures[]" value="Embossed"> Embossed</label><br>
                                            <label><input type="checkbox" name="textures[]" value="Perforated"> Perforated</label>
                                        </div>
                                        <div style="margin-top: 10px;">
                                            <label><h4 style="font-size: 18px;"><input type="checkbox" name="textures[]" value="Other Textures"> Other Textures</h4></label>
                                        </div>
                                    </div>
                                </div>

                                <div class="d-flex align-items-center">
                                    <button type="button" class="btn btn-primary mt-3" style="height: 45px; width: 200px;" onclick="assignTextures()">Assign Textures</button>
                                    <strong class="text-muted" style="margin-left: 100px;">Assigned Textures:</strong>
                                </div>
                                    <!-- Assigned Material Buttons Section -->
                                    <div class="d-flex flex-wrap mt-2 p-3" style="min-height: 150px;">
                                        <!-- Material Buttons Container -->
                                        <div id="textures-container" style="height: 45px;" class="d-flex flex-wrap"></div>
                                            
                                        <!-- Remove Button Container -->
                                        <div id="remove-button-container"></div>
                                    </div>
                                </div>
   
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        
        </div>
        <!-- Post and Cancel Buttons -->
        <div class="text-center" style="margin-bottom: 50px;">
            <button type="submit" name="post" style="font-size: 26px;" class="btn btn-success">Post</button>
            <a href="{% url 'posts:post_list' %}" class="btn btn-danger" style="font-size: 26px;">Cancel</a>
        </div>
    </form>
</div>

<script>
    function handleFileSelect(event) {
        const file = event.target.files[0];
        const preview = document.getElementById('image-preview');
        const noImageText = document.getElementById('no-image-text');
        if (file) {
            const reader = new FileReader();
            reader.onload = function (e) {
                preview.src = e.target.result;
                preview.style.display = 'block';
                noImageText.style.display = 'none';
            };
            reader.readAsDataURL(file);
        } else {
            preview.src = '';
            preview.style.display = 'none';
            noImageText.style.display = 'block';
        }
    }

    document.addEventListener('DOMContentLoaded', function () {
        const imageInput = document.getElementById('image-input');
        const fileNameContainer = document.getElementById('file-name-container');
        const eraDropdown = document.getElementById('era');
        const yearTextbox = document.getElementById('year');
        const monthDropdown = document.getElementById('month');
        const dayDropdown = document.getElementById('day');
        const assignTimeButton = document.querySelector('button[onclick="assignTimePeriod()"]');

        const assignedEra = document.getElementById('assigned-era');
        const assignedYear = document.getElementById('assigned-year');
        const assignedMonth = document.getElementById('assigned-month');
        const assignedDay = document.getElementById('assigned-day');

        // Set a default placeholder for the file name container
        fileNameContainer.value = "No file selected";

        // Handle image file selection
        imageInput.addEventListener('change', function () {
            const file = imageInput.files[0];
            if (file) {
                fileNameContainer.value = file.name;
            } else {
                fileNameContainer.value = "No file selected";
            }
        });

        // Set the default state when the page loads
        eraDropdown.value = ""; // Default to "Select Era"
        yearTextbox.disabled = true; // Disable the year textbox initially
        monthDropdown.disabled = true; // Disable the month dropdown initially
        dayDropdown.disabled = true; // Disable the day dropdown initially
        assignTimeButton.disabled = true; // Disable the Assign Time button initially

        // Handle era dropdown changes
        eraDropdown.addEventListener('change', function () {
            const selectedEra = eraDropdown.value;

            if (selectedEra === "") {
                yearTextbox.disabled = true;
                assignTimeButton.disabled = true;
                monthDropdown.disabled = true;
                dayDropdown.disabled = true;
                yearTextbox.value = ""; // Clear the year textbox
                monthDropdown.value = ""; // Reset the month dropdown
                dayDropdown.value = ""; // Reset the day dropdown
            } else {
                // Enable the "Assign Time" button if a valid era is selected
                assignTimeButton.disabled = false;
                yearTextbox.disabled = false;

                // Set the max length and validation based on the selected era
                if (selectedEra === "AC") {
                    yearTextbox.setAttribute("maxlength", "4");
                    yearTextbox.setAttribute("placeholder", "Up to current year");
                } else if (selectedEra === "BC") {
                    yearTextbox.setAttribute("maxlength", "12");
                    yearTextbox.setAttribute("placeholder", "Enter up to 12 digits");
                }
            }
        });

        // Validate year textbox input and enable month dropdown
        yearTextbox.addEventListener('input', function () {
            const value = yearTextbox.value;

            // Allow only positive integers
            if (!/^\d*$/.test(value)) {
                yearTextbox.value = value.replace(/\D/g, ''); // Remove non-numeric characters
            }

            if (eraDropdown.value === "AC" && parseInt(value, 10) > new Date().getFullYear()) {
                yearTextbox.value = new Date().getFullYear().toString(); // Limit to current year
            }

            // Enable or disable the month dropdown based on year textbox value
            if (value.trim()) {
                monthDropdown.disabled = false;
                assignTimeButton.disabled = false; // Activate the Assign Time button
            } else {
                monthDropdown.disabled = true;
                monthDropdown.value = ""; // Reset the month dropdown
                dayDropdown.disabled = true;
                dayDropdown.value = ""; // Reset the day dropdown
                assignTimeButton.disabled = true; // Deactivate the Assign Time button
            }
        });

        // Handle month dropdown changes and enable day dropdown
        monthDropdown.addEventListener('change', function () {
            if (monthDropdown.value) {
                dayDropdown.disabled = false;

                // Update day dropdown options based on the selected month
                updateDayDropdownOptions(monthDropdown.value);
            } else {
                dayDropdown.disabled = true;
                dayDropdown.value = ""; // Reset the day dropdown
            }
        });

        // Function to update day dropdown options based on the selected month
        function updateDayDropdownOptions(month) {
            const daysInMonth = getDaysInMonth(month);
            dayDropdown.innerHTML = ""; // Clear existing options

            // Add default option
            const defaultOption = document.createElement('option');
            defaultOption.value = "00";
            defaultOption.textContent = "Select Day";
            dayDropdown.appendChild(defaultOption);

            // Add day options dynamically
            for (let day = 1; day <= daysInMonth; day++) {
                const option = document.createElement('option');
                const dayValue = day.toString().padStart(2, "0");
                option.value = dayValue;
                option.textContent = day;
                dayDropdown.appendChild(option);
            }
        }

        // Example function to calculate days in a month
        function getDaysInMonth(month) {
            const monthDays = {
                "01": 31, // JAN
                "02": 28, // FEB (not accounting for leap year here)
                "03": 31, // MAR
                "04": 30, // APR
                "05": 31, // MAY
                "06": 30, // JUN
                "07": 31, // JUL
                "08": 31, // AUG
                "09": 30, // SEP
                "10": 31, // OCT
                "11": 30, // NOV
                "12": 31  // DEC
            };
            return monthDays[month] || 0;
        }
        // Update the assigned values when Era is changed
        eraDropdown.addEventListener('change', function () {
            assignedEra.textContent = eraDropdown.value || "None";
        });

        // Update the assigned values when Year is typed
        yearTextbox.addEventListener('input', function () {
            assignedYear.textContent = yearTextbox.value || "None";
        });

        // Update the assigned values when Month is changed
        monthDropdown.addEventListener('change', function () {
            assignedMonth.textContent = monthDropdown.value || "None";
        });

        // Update the assigned values when Day is changed
        dayDropdown.addEventListener('change', function () {
            assignedDay.textContent = dayDropdown.value || "None";
        });
            // Function to update the hidden input value
        function updateHiddenTimePeriodBackend() {
            const era = eraDropdown.value; // "AC" or "BC"
            const year = yearTextbox.value.trim(); // Year value as a string
            const month = monthDropdown.value; // Assigned month value (e.g., "03")
            const day = dayDropdown.value; // Assigned day value (e.g., "15")

            // Check if Era is not selected; clear hidden input and return
            if (!era) {
                hiddenTimePeriodBackend.value = "";
                displayHiddenValue.textContent = "None";
                return;
            }

            // Combine the values into a single integer string
            let combinedValue = "";

            // Add a negative sign if "BC" is selected
            if (era === "BC") {
                combinedValue += "-";
            }

            // Add year, month, and day to the combined value
            combinedValue += year.padStart(4, "0"); // Ensure the year is at least 4 digits
            combinedValue += month.padStart(2, "0"); // Ensure the month is 2 digits
            combinedValue += day.padStart(2, "0"); // Ensure the day is 2 digits

            // Record the combined value in the hidden input and display it
            hiddenTimePeriodBackend.value = parseInt(combinedValue, 10); // Convert to integer
            displayHiddenValue.textContent = hiddenTimePeriodBackend.value; // Display for testing
        }

        // Attach event listeners to update the hidden input when values change
        eraDropdown.addEventListener('change', updateHiddenTimePeriodBackend);
        yearTextbox.addEventListener('input', updateHiddenTimePeriodBackend);
        monthDropdown.addEventListener('change', updateHiddenTimePeriodBackend);
        dayDropdown.addEventListener('change', updateHiddenTimePeriodBackend);

        
    });




    function fetchWikidataSuggestions(query) {
        const suggestionsList = document.getElementById('suggestions-list');
        suggestionsList.innerHTML = ''; // Clear previous suggestions

        if (!query.trim()) {
            suggestionsList.style.display = 'none';
            return;
        }

        const apiUrl = `https://www.wikidata.org/w/api.php?action=wbsearchentities&search=${encodeURIComponent(query)}&language=en&format=json&origin=*`;

        fetch(apiUrl)
            .then(response => response.json())
            .then(data => {
                if (data.search && data.search.length > 0) {
                    suggestionsList.style.display = 'block';
                    data.search.forEach(item => {
                        const suggestionItem = document.createElement('li');
                        suggestionItem.className = 'list-group-item list-group-item-action';
                        suggestionItem.textContent = `${item.label} - ${item.description || ''}`;
                        suggestionItem.onclick = () => selectSuggestion(item.label, item.id);
                        suggestionsList.appendChild(suggestionItem);
                    });
                } else {
                    suggestionsList.style.display = 'none';
                }
            })
            .catch(error => {
                console.error('Error fetching suggestions:', error);
                suggestionsList.style.display = 'none';
            });
    }

    function selectSuggestion(label, wikidataId) {
        const inputField = document.getElementById('additional-info');
        inputField.value = label;

        // Attach the Wikidata ID for the selected tag as a data attribute (used in addTag)
        inputField.dataset.wikidataId = wikidataId;

        const suggestionsList = document.getElementById('suggestions-list');
        suggestionsList.style.display = 'none';
    }

    function addTag() {
        const inputField = document.getElementById('additional-info');
        const tagsContainer = document.getElementById('tags-container');
        const hiddenTags = document.getElementById('hidden-tags');
        const tagLabel = inputField.value.trim();
        const wikidataId = inputField.dataset.wikidataId;

        if (!tagLabel || !wikidataId) {
            alert("Please select a tag from the suggestions.");
            return;
        }

        // Check for duplicates
        const existingTags = JSON.parse(hiddenTags.value || '[]');
        if (existingTags.some(tag => tag.id === wikidataId)) {
            alert("This tag is already added.");
            return;
        }

        // Create tag button with Wikidata link
        const tagWrapper = document.createElement('div');
        tagWrapper.className = 'd-inline-block me-2 mb-2';

        const tagButton = document.createElement('button');
        tagButton.type = 'button';
        tagButton.className = 'btn btn-outline-primary';
        tagButton.textContent = tagLabel;
        tagButton.onclick = () => window.open(`https://www.wikidata.org/wiki/${wikidataId}`, '_blank');

        const removeButton = document.createElement('button');
        removeButton.type = 'button';
        removeButton.className = 'btn btn-danger btn-sm ms-2';
        removeButton.textContent = 'X';
        removeButton.onclick = () => {
            tagsContainer.removeChild(tagWrapper);
            updateHiddenTags();
        };

        tagWrapper.appendChild(tagButton);
        tagWrapper.appendChild(removeButton);
        tagsContainer.appendChild(tagWrapper);

        // Update hidden input with the new tag
        existingTags.push({ label: tagLabel, id: wikidataId });
        hiddenTags.value = JSON.stringify(existingTags);

        // Clear input field and its associated data
        inputField.value = '';
        delete inputField.dataset.wikidataId;
    }

    function updateHiddenTags() {
        const tagsContainer = document.getElementById('tags-container');
        const hiddenTags = document.getElementById('hidden-tags');
        const tags = [];

        tagsContainer.querySelectorAll('.btn-outline-primary').forEach(tagButton => {
            const tagName = tagButton.textContent;
            const wikidataId = tagButton.onclick.toString().match(/\/wiki\/(\w+)/)[1];
            tags.push({ label: tagName, id: wikidataId });
        });

        hiddenTags.value = JSON.stringify(tags);
    }



    function addColor() {
        const colorPicker = document.getElementById('color-picker');
        const colorsContainer = document.getElementById('colors-container');
        const hiddenColors = document.getElementById('hidden-colors');
        const colorValue = colorPicker.value;

        // Categorize the picked color
        const colorCategory = categorizeColor(colorValue);

        // Create a wrapper for the color and remove button
        const colorWrapper = document.createElement('div');
        colorWrapper.className = 'd-inline-block me-2 mb-2';

        // Create the color button
        const colorButton = document.createElement('button');
        colorButton.className = 'btn btn-outline-primary';
        colorButton.style.backgroundColor = colorValue;
        colorButton.style.color = getTextColorForBackground(colorValue); // Ensure contrast
        colorButton.textContent = colorCategory;

        // Create the remove "X" button
        const removeButton = document.createElement('button');
        removeButton.className = 'btn btn-danger btn-sm ms-2';
        removeButton.textContent = 'X';
        removeButton.onclick = () => {
            colorsContainer.removeChild(colorWrapper);
            updateHiddenColors();
        };

        // Append the color button and remove button to the wrapper
        colorWrapper.appendChild(colorButton);
        colorWrapper.appendChild(removeButton);

        // Append the wrapper to the colors container
        colorsContainer.appendChild(colorWrapper);

        // Update the hidden colors input field
        updateHiddenColors();
    }

    // Categorize the picked color based on the RGB values
    function categorizeColor(hexColor) {
        // Convert hex to RGB
        const rgb = parseInt(hexColor.substring(1), 16);
        const r = (rgb >> 16) & 0xff;
        const g = (rgb >> 8) & 0xff;
        const b = rgb & 0xff;

        // Apply the categorization rules
        if (r > 1.2 * g && r > 1.2 * b) return "Red";
        if (r > g && b > g && r >= 1.5 * b) return "Pink";
        if (r > g && g > b) return "Orange";
        if (r >= g && b < 0.5 * (r + g)) return "Yellow";
        if (g > 1.2 * r && g > 1.2 * b) return "Green";
        if (b > 1.2 * r && b > 1.2 * g) return "Blue";
        if (r >= b && r > g && b > g) return "Purple";
        if (r > g && g > b && r + g + b < 384) return "Brown";
        if (Math.abs(r - g) < 20 && Math.abs(g - b) < 20 && r + g + b < 128) return "Black";
        if (Math.abs(r - g) < 20 && Math.abs(g - b) < 20 && r + g + b > 700) return "White";
        if (Math.abs(r - g) < 20 && Math.abs(g - b) < 20) return "Gray";
        if (g === b && g > r) return "Cyan and Teal";
        return "Neutral"; // Default category
    }

    // Helper function to determine text color for contrast
    function getTextColorForBackground(color) {
        // Convert hex color to RGB
        const rgb = parseInt(color.substring(1), 16);
        const r = (rgb >> 16) & 0xff;
        const g = (rgb >> 8) & 0xff;
        const b = rgb & 0xff;

        // Calculate brightness
        const brightness = (r * 299 + g * 587 + b * 114) / 1000;

        // Return black for bright colors, white for dark colors
        return brightness > 125 ? '#000' : '#fff';
    }

    // Update the hidden colors input field
    function updateHiddenColors() {
        const colorsContainer = document.getElementById('colors-container');
        const hiddenColors = document.getElementById('hidden-colors');
        const colors = [];

        colorsContainer.querySelectorAll('.btn-outline-primary').forEach(colorButton => {
            colors.push(colorButton.textContent);
        });

        hiddenColors.value = colors.join(',');
    }

    // Function to validate and accept only positive numeric entries (integers or decimals)
    function isNumeric(value) {
        // Remove whitespace
        value = value.trim();

        // Allow a single leading dot and add 0 before it
        if (value.startsWith(".")) {
            value = "0" + value;
        }

        // Regular expression to match valid positive numbers (integers or decimals)
        const numericRegex = /^\d+(\.\d+)?$/;

        // Check if the value matches the regex
        return numericRegex.test(value.trim()) ? value : null;
    }

    // Function to handle the Assign Sizes logic
    function assignSizes() {
        // Get input fields
        const lengthInput = document.getElementById("length-input");
        const widthInput = document.getElementById("width-input");
        const heightInput = document.getElementById("height-input");

        // Get the values entered in textboxes and validate the inputs
        const validLength = isNumeric(lengthInput.value.trim());
        const validWidth = isNumeric(widthInput.value.trim());
        const validHeight = isNumeric(heightInput.value.trim());

        // If any value is invalid, show an error message and exit
        if (!validLength || !validWidth || !validHeight) {
            alert("Do not enter invalid values as negative numbers, do not type any characters other than numbers and do not use any punctuations except dot!");
            return; // Stop execution
        }

        // Update the hidden fields with valid values
        document.getElementById("hidden-length").value = validLength;
        document.getElementById("hidden-width").value = validWidth;
        document.getElementById("hidden-height").value = validHeight;

        // If all values are valid, update the buttons
        updateSizeButton(validLength, "length-button");
        updateSizeButton(validWidth, "width-button");
        updateSizeButton(validHeight, "height-button");

        console.log(`Length: ${validLength}, Width: ${validWidth}, Height: ${validHeight}`);
    }

    // Function to update buttons with the entered value
    function updateSizeButton(value, buttonId) {
        const button = document.getElementById(buttonId);
        button.textContent = value; // Set the numeric value as button text
        button.classList.remove("btn-secondary");
        button.classList.add("btn-success");
    }

    // Function to reset sizes
    function resetSizes() {
        // Clear input fields
        document.getElementById("length-input").value = "";
        document.getElementById("width-input").value = "";
        document.getElementById("height-input").value = "";

        // Reset button text and class
        resetSizeButton("length-button", "");
        resetSizeButton("width-button", "");
        resetSizeButton("height-button", "");
    }

    // Function to reset individual size buttons
    function resetSizeButton(buttonId, defaultText) {
        const button = document.getElementById(buttonId);
        button.textContent = defaultText || ""; // Default text if not provided
        button.classList.remove("btn-success");
        button.classList.add("btn-secondary");
    }

    function assignWeight() {
        const inputField = document.getElementById("weight");
        const weightContainer = document.getElementById("weight-container");
        const hiddenWeight = document.getElementById("hidden-weight"); // Hidden input

        let inputValue = inputField.value.trim();

        // If the value starts with a dot (.), prepend a zero (e.g., ".5" becomes "0.5")
        if (inputValue.startsWith(".")) {
            inputValue = "0" + inputValue;
        }

        // Validate input: allow only numeric values and decimal numbers, no punctuation except dot (.)
        const isValid = /^\d+(\.\d+)?$/.test(inputValue);

        if (!isValid) {
            alert("Please enter a valid positive number. Only numeric values and a single dot (.) are allowed.");
            return;
        }

        // Check if a button already exists to prevent multiple creations
        if (weightContainer.children.length > 0) {
            alert("A weight is already assigned. Remove the existing weight first.");
            return;
        }

        // Create a wrapper for the button and remove "X" button
        const buttonWrapper = document.createElement("div");
        buttonWrapper.className = "d-inline-block";

        // Create the weight button
        const weightButton = document.createElement("button");
        weightButton.className = "btn btn-outline-primary";
        weightButton.textContent = `${inputValue}`;

        // Create the "X" button to remove the weight
        const removeButton = document.createElement("button");
        removeButton.className = "btn btn-danger btn-sm ms-2";
        removeButton.textContent = "X";
        removeButton.onclick = () => {
            weightContainer.removeChild(buttonWrapper);
            hiddenWeight.value = ""; // Clear the hidden weight field
        };

        // Append the weight button and "X" button to the wrapper
        buttonWrapper.appendChild(weightButton);
        buttonWrapper.appendChild(removeButton);

        // Append the wrapper to the container
        weightContainer.appendChild(buttonWrapper);

        // Update the hidden input field with the weight value
        hiddenWeight.value = inputValue;

        // Clear the input field
        inputField.value = "";
    }


    function assignPrice() {
        const inputField = document.getElementById("price");
        const priceContainer = document.getElementById("price-container");
        let inputValue = inputField.value.trim();

        // If the value starts with a dot (.), prepend a zero (e.g., ".5" becomes "0.5")
        if (inputValue.startsWith(".")) {
            inputValue = "0" + inputValue;
        }

        // Validate input: allow only numeric values and decimal numbers, no punctuation except dot (.)
        const isValid = /^\d+(\.\d+)?$/.test(inputValue);

        if (!isValid) {
            alert("Please enter a valid positive number for Price. Only numeric values and a single dot (.) are allowed.");
            return;
        }

        // Check if a button already exists to prevent multiple creations
        if (priceContainer.children.length > 0) {
            alert("A price is already assigned. Remove the existing price first.");
            return;
        }

        // Create a wrapper for the button and remove "X" button
        const buttonWrapper = document.createElement("div");
        buttonWrapper.className = "d-inline-block";

        // Create the price button
        const priceButton = document.createElement("button");
        priceButton.className = "btn btn-outline-primary";
        priceButton.textContent = `${inputValue}`;

        // Create the "X" button to remove the price
        const removeButton = document.createElement("button");
        removeButton.className = "btn btn-danger btn-sm ms-2";
        removeButton.textContent = "X";
        removeButton.onclick = () => {
            priceContainer.removeChild(buttonWrapper);
        };

        // Append the price button and "X" button to the wrapper
        buttonWrapper.appendChild(priceButton);
        buttonWrapper.appendChild(removeButton);

        // Append the wrapper to the container
        priceContainer.appendChild(buttonWrapper);

        // Update the hidden input field with the assigned price
        document.getElementById("hidden-price").value = inputValue;

        // Clear the input field
        inputField.value = "";
    }

    // Replace the existing assignTimePeriod() function with this updated version
    function assignTimePeriod() {
        const eraDropdown = document.getElementById('era');
        const yearTextbox = document.getElementById('year');
        const monthDropdown = document.getElementById('month');
        const dayDropdown = document.getElementById('day');
        const eraContainer = document.getElementById('era-container');
        const timeDisplayContainer = document.getElementById('time-period-display-container');
        const removeButtonContainer = document.getElementById('remove-button-container');
        
        const era = eraDropdown.value;
        const year = yearTextbox.value.trim();
        const monthValue = monthDropdown.value;
        const monthText = monthDropdown.options[monthDropdown.selectedIndex]?.text || "";
        const day = dayDropdown.value;

        // Validate inputs
        if (!era || !year) {
            alert('Era and Year are required!');
            return;
        }

        // Clear existing buttons
        eraContainer.innerHTML = '';
        timeDisplayContainer.innerHTML = '';
        removeButtonContainer.innerHTML = '';

        // Create Era Button
        const eraButton = document.createElement('button');
        eraButton.type = 'button';
        eraButton.className = 'btn btn-outline-primary me-2';
        eraButton.textContent = era;
        eraButton.disabled = true;
        eraContainer.appendChild(eraButton);

        // Construct time period display text
        let timePeriodDisplay = year;
        if (monthValue && monthValue !== "00") {
            if (day && day !== "00") {
                timePeriodDisplay = `${day}/${monthText}/${year}`;
            } else {
                timePeriodDisplay = `${monthText}/${year}`;
            }
        }

        // Create Time Period Display Button
        const timeButton = document.createElement('button');
        timeButton.type = 'button';
        timeButton.className = 'btn btn-outline-primary me-2';
        timeButton.textContent = timePeriodDisplay;
        timeButton.disabled = true;
        timeDisplayContainer.appendChild(timeButton);

        // Create Remove Button
        const removeButton = document.createElement('button');
        removeButton.type = 'button';
        removeButton.className = 'btn btn-danger btn-sm';
        removeButton.textContent = 'X';
        removeButton.onclick = () => {
            // Clear all containers
            eraContainer.innerHTML = '';
            timeDisplayContainer.innerHTML = '';
            removeButtonContainer.innerHTML = '';
            // Reset inputs
            resetInputs();
            // Clear hidden inputs
            document.getElementById('hidden-era').value = '';
            document.getElementById('hidden-time-period').value = '';
        };
        removeButtonContainer.appendChild(removeButton);

        // Update hidden inputs
        document.getElementById('hidden-era').value = era;
        
        // Construct backend time period value
        let backendTimePeriod = `${era}/${year}`;
        if (monthValue && monthValue !== "00") {
            backendTimePeriod += `/${monthText}`;
            if (day && day !== "00") {
                backendTimePeriod += `/${day}`;
            }
        }
        document.getElementById('hidden-time-period').value = backendTimePeriod;

        // Disable inputs after assignment
        eraDropdown.disabled = true;
        yearTextbox.disabled = true;
        monthDropdown.disabled = true;
        dayDropdown.disabled = true;
    }


    function resetInputs() {
        const eraDropdown = document.getElementById('era');
        const yearTextbox = document.getElementById('year');
        const monthDropdown = document.getElementById('month');
        const dayDropdown = document.getElementById('day');
        const assignButton = document.querySelector('button[onclick="assignTimePeriod()"]');

        // Reset values
        eraDropdown.value = "";
        yearTextbox.value = "";
        monthDropdown.value = "";
        dayDropdown.value = "";

        // Enable inputs
        eraDropdown.disabled = false;
        yearTextbox.disabled = true; // Disabled until era is selected again
        monthDropdown.disabled = true;
        dayDropdown.disabled = true;

        // Restore placeholders
        yearTextbox.setAttribute("placeholder", "Type the Year");
        
        // Reset the Month Dropdown placeholder
        monthDropdown.innerHTML = `
            <option value="" selected>Select Month</option>
            <option value="01">JAN</option>
            <option value="02">FEB</option>
            <option value="03">MAR</option>
            <option value="04">APR</option>
            <option value="05">MAY</option>
            <option value="06">JUN</option>
            <option value="07">JUL</option>
            <option value="08">AUG</option>
            <option value="09">SEP</option>
            <option value="10">OCT</option>
            <option value="11">NOV</option>
            <option value="12">DEC</option>
        `;

        // Reset the Day Dropdown placeholder
        dayDropdown.innerHTML = `
            <option value="" selected>Select Day</option>
        `;

        // Enable the Assign Time button
        assignButton.disabled = true;
    }







    function updateHiddenEra() {
        const eraDropdown = document.getElementById('era');
        const hiddenEra = document.getElementById('hidden-era');

        // Update the hidden input value to match the selected era
        hiddenEra.value = eraDropdown.value;
    }

    function assignMaterials() {
        const materialsContainer = document.getElementById('materials-container');
        const checkboxes = document.querySelectorAll('input[name="materials[]"]:checked');

        // Clear the existing buttons
        materialsContainer.innerHTML = '';

        checkboxes.forEach((checkbox) => {
            const material = checkbox.value;

            // Create a wrapper div for the material button and remove button
            const buttonWrapper = document.createElement('div');
            buttonWrapper.className = 'd-inline-block me-2 mb-2';

            // Create the material button
            const materialButton = document.createElement('button');
            materialButton.className = 'btn btn-outline-primary';
            materialButton.textContent = material;
            materialButton.disabled = true; // Disable material button (for display only)

            // Create the remove (X) button
            const removeButton = document.createElement('button');
            removeButton.className = 'btn btn-danger btn-sm ms-2';
            removeButton.textContent = 'X';
            removeButton.onclick = () => {
                // Uncheck the corresponding checkbox
                checkbox.checked = false;
                // Remove the button wrapper from the container
                materialsContainer.removeChild(buttonWrapper);
            };

            // Append buttons to the wrapper and add to the container
            buttonWrapper.appendChild(materialButton);
            buttonWrapper.appendChild(removeButton);
            materialsContainer.appendChild(buttonWrapper);
        });
    }

    function assignShapes() {
        const shapesContainer = document.getElementById('shapes-container');
        const checkboxes = document.querySelectorAll('input[name="shapes[]"]:checked');
        const hiddenShapesInput = document.getElementById('hidden-shapes');

        // Clear the existing buttons
        shapesContainer.innerHTML = '';

        let shapesList = []; // To store selected shapes

        checkboxes.forEach((checkbox) => {
            const shape = checkbox.value;
            shapesList.push(shape);

            // Create a wrapper div for the shape button and remove button
            const buttonWrapper = document.createElement('div');
            buttonWrapper.className = 'd-inline-block me-2 mb-2';

            // Create the shape button
            const shapeButton = document.createElement('button');
            shapeButton.className = 'btn btn-outline-primary';
            shapeButton.textContent = shape;
            shapeButton.disabled = true; // Disable shape button (for display only)

            // Create the remove (X) button
            const removeButton = document.createElement('button');
            removeButton.className = 'btn btn-danger btn-sm ms-2';
            removeButton.textContent = 'X';
            removeButton.onclick = () => {
                // Uncheck the corresponding checkbox
                checkbox.checked = false;
                // Remove the button wrapper from the container
                shapesContainer.removeChild(buttonWrapper);

                // Remove the shape from the list
                shapesList = shapesList.filter((item) => item !== shape);
                hiddenShapesInput.value = shapesList.join(','); // Update hidden input
            };

            // Append buttons to the wrapper and add to the container
            buttonWrapper.appendChild(shapeButton);
            buttonWrapper.appendChild(removeButton);
            shapesContainer.appendChild(buttonWrapper);
        });

        // Update the hidden input with selected shapes
        hiddenShapesInput.value = shapesList.join(',');
    }

    function assignTextures() {
        const texturesContainer = document.getElementById('textures-container');
        const checkboxes = document.querySelectorAll('input[name="textures[]"]:checked');
        const hiddenTexturesInput = document.getElementById('hidden-textures');

        // Clear the existing buttons
        texturesContainer.innerHTML = '';

        let texturesList = []; // To store selected textures

        checkboxes.forEach((checkbox) => {
            const texture = checkbox.value;
            texturesList.push(texture);

            // Create a wrapper div for the texture button and remove button
            const buttonWrapper = document.createElement('div');
            buttonWrapper.className = 'd-inline-block me-2 mb-2';

            // Create the texture button
            const textureButton = document.createElement('button');
            textureButton.className = 'btn btn-outline-primary';
            textureButton.textContent = texture;
            textureButton.disabled = true; // Disable texture button (for display only)

            // Create the remove (X) button
            const removeButton = document.createElement('button');
            removeButton.className = 'btn btn-danger btn-sm ms-2';
            removeButton.textContent = 'X';
            removeButton.onclick = () => {
                // Uncheck the corresponding checkbox
                checkbox.checked = false;
                // Remove the button wrapper from the container
                texturesContainer.removeChild(buttonWrapper);

                // Remove the texture from the list
                texturesList = texturesList.filter((item) => item !== texture);
                hiddenTexturesInput.value = texturesList.join(','); // Update hidden input
            };

            // Append buttons to the wrapper and add to the container
            buttonWrapper.appendChild(textureButton);
            buttonWrapper.appendChild(removeButton);
            texturesContainer.appendChild(buttonWrapper);
        });

        // Update the hidden input with selected textures
        hiddenTexturesInput.value = texturesList.join(',');
    }








</script>
{% endblock %}
